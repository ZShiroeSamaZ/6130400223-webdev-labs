<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>NY Times API example</title>
    <link href="styles/nytimes.css" rel="stylesheet" />
  </head>
  <body>
    <h1>NY Times video search</h1>

    <div class="wrapper">
      <div class="controls">
        <form>
          <p>
            <label for="search">Enter a SINGLE search term (required): </label>
            <input type="text" id="search" class="search" required />
          </p>
          <p>
            <label for="start-date"
              >Enter a start date (format YYYYMMDD):
            </label>
            <input
              type="date"
              id="start-date"
              class="start-date"
              pattern="[0-9]{8}"
            />
          </p>
          <p>
            <label for="end-date">Enter an end date (format YYYYMMDD): </label>
            <input
              type="date"
              id="end-date"
              class="end-date"
              pattern="[0-9]{8}"
            />
          </p>
          <p>
            <button class="submit">Submit search</button>
          </p>
        </form>
      </div>

      <div class="results">
        <nav>
          <button class="prev">Previous 10</button>
          <button class="next">Next 10</button>
        </nav>

        <section>

        </section>
      </div>
    </div>

    <script>
      // Defining a baseURL and key to as part of the request URL
      var baseURL =
        "https://api.nytimes.com/svc/search/v2/articlesearch.json?q=";
      var key = "StuGGX3DI56Sg5BiacNBwkgdwNsJPJnB";
      var url;
      // Grab references to all the DOM elements you'll need to manipulate
      var searchTerm = document.querySelector(".search");
      var startDate = document.querySelector(".start-date");
      var endDate = document.querySelector(".end-date");
      var searchForm = document.querySelector("form");
      var submitBtn = document.querySelector(".submit");
      var nextBtn = document.querySelector(".next");
      var previousBtn = document.querySelector(".prev");
      var section = document.querySelector("section");
      var nav = document.querySelector("nav");
      // Hide the "Previous"/"Next" navigation to begin with, as we don't need it immediately
      nav.style.display = "none";
      // define the initial page number and status of the navigation being displayed
      var pageNumber = 0;
      var displayNav = false;
      // Event listeners to control the functionality
      submitBtn.addEventListener("click", (e) => {
        e.preventDefault()
        const searchInput = searchTerm.value + `&fq=document_type:("article")`

        url = baseURL + searchInput
        url += "&api-key=" + key //init key
        url += startDate.value !== "" ? `&begin_date=${startDate.value}` : ""
        url += endDate.value !== "" ? `&end_date=${endDate.value}` : ""

        console.log(url);
        fetch(url)
          .then((res) => {
            return res.json();
          })
          .then((json) => {
            section.innerHTML = ""
            const docs = json.response.docs;
            console.log(docs);
            docs.forEach(doc => {
                let article = `<article>`
                article += `<h2><a href="${doc.web_url}" target="_blank"> ${doc.headline.main} </a></h2>`
                article += doc.multimedia.length > 0 ? `<img src="http://www.nytimes.com/${doc.multimedia[0].url}" alt="${doc.headline.main}" class="center">`: ""
                article += `<p> ${doc.snippet} </p>`
                article += `<p> keyword:`
                doc.keywords.forEach(keyword => {
                    article += `<span>${keyword.value}</span>`
                });
                article += ` </p></article>`
                section.innerHTML += article
            });
            
          });
      });
    </script>
  </body>
</html>
